<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nahuel Electrohogar | Tienda</title>
  <meta name="description" content="Electrodomésticos en 4 cuotas. Heladeras, TV, aires y más." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0e1321; --panel:#0b1220; --card:#111827;
      --text:#e5e7eb; --muted:#9ca3af; --border:#1f2937;
      --accent:#22c55e; --accent-2:#16a34a; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);background:linear-gradient(180deg,#0b1020,#0f172a);}
    .container{max-width:1200px;margin:auto;padding:0 16px}
    .topbar{background:#0b1220;border-bottom:1px solid var(--border);font-size:14px}
    .topbar__inner{display:flex;justify-content:space-between;align-items:center;padding:8px 0;color:var(--muted)}
    .nav{position:sticky;top:0;z-index:10;background:rgba(11,18,32,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .nav__inner{display:flex;align-items:center;gap:16px;padding:14px 0}
    .logo{color:var(--text);text-decoration:none;font-weight:700;font-size:20px}
    .logo span{color:var(--accent)}
    .searchbox{display:flex;gap:8px;flex:1}
    .searchbox input{flex:1;background:#0c1426;border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px;outline:none}
    .searchbox button{background:var(--accent);border:none;color:#062d16;border-radius:10px;padding:10px 14px;cursor:pointer}
    .cartbtn{background:#0c1426;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:8px 12px;cursor:pointer;position:relative}
    .badge{position:absolute;top:-6px;right:-6px;background:var(--accent);color:#062d16;border-radius:999px;padding:1px 6px;font-size:12px}
    .filters{border-top:1px solid var(--border);border-bottom:1px solid var(--border);background:#0b1220}
    .filters__inner{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 0;flex-wrap:wrap}
    .selects select{background:#0c1426;border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px;outline:none}
    h1{margin:24px 0 12px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(1,1fr)}
    @media(min-width:680px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1000px){.grid{grid-template-columns:repeat(4,1fr)}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;display:flex;flex-direction:column;min-height:100%}
    .card-img{width:100%;height:190px;object-fit:cover}
    .card-body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .card-title{margin:0 0 4px}
    .price{font-weight:700}
    .btn{display:inline-block;border:1px solid var(--border);border-radius:12px;padding:10px 14px;text-decoration:none;color:var(--text);cursor:pointer;transition:.15s}
    .btn--primary{background:var(--accent);border-color:transparent;color:#062d16}
    .btn--ghost{background:#0c1426}
    /* Drawer carrito */
    .cart{ position:fixed; top:0; right:0; width:420px; max-width:96%; height:100%;
      background:#0b1220; border-left:1px solid var(--border); box-shadow:-16px 0 40px rgba(0,0,0,.35);
      transform:translateX(100%); transition:transform .35s cubic-bezier(.22,.61,.36,1); z-index:100; display:flex; flex-direction:column; }
    .cart.open{ transform:translateX(0); }
    .cart__header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);padding:12px}
    .cart__items{padding:12px;flex:1;overflow:auto}
    .cart__footer{border-top:1px solid var(--border);padding:12px;display:flex;flex-direction:column;gap:10px}
    .cart__row{display:flex;justify-content:space-between;color:var(--muted)}
    .cart__total{display:flex;justify-content:space-between;font-size:18px}
    .cartline{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:12px;padding:10px;margin:8px 0}
    .cartline__info{display:flex;flex-direction:column}
    .cartline__qty{display:flex;align-items:center;gap:8px}
    .cartline__qty button{background:#0c1426;border:1px solid var(--border);color:var(--text);border-radius:8px;padding:4px 10px;cursor:pointer}
    .backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.45); opacity:0; visibility:hidden; transition:opacity .25s ease, visibility .25s ease; z-index:90; }
    .backdrop.show{ opacity:1; visibility:visible; }
    .muted{color:var(--muted)}
    .discount-line{display:flex;justify-content:space-between;color:#a7f3d0}
    .coupon-ok{color:#34d399;font-weight:600}
    .coupon-bad{color:#f87171}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="container topbar__inner">
      <span>Envíos a todo el país · 4 cuotas</span>
      <a href="#contacto" style="color:#e5e7eb;text-decoration:none">Ayuda</a>
    </div>
  </div>

  <header class="nav">
    <div class="container nav__inner">
      <a href="#" class="logo">Nahuel<span>Electro</span></a>
      <div class="searchbox">
        <input id="searchInput" type="search" placeholder="Buscar: heladera, TV, lavarropas..." />
        <button id="searchBtn">Buscar</button>
      </div>
      <button id="openCart" class="cartbtn" aria-label="Abrir carrito">🛒<span id="cartCount" class="badge">0</span></button>
    </div>
  </header>

  <section class="filters">
    <div class="container filters__inner">
      <div class="selects">
        <select id="categoryFilter">
          <option value="all">Todas las categorías</option>
          <option value="Heladeras">Heladeras</option>
          <option value="Lavarropas">Lavarropas</option>
          <option value="Microondas">Microondas</option>
          <option value="Aires">Aires Acond.</option>
          <option value="TV">Smart TV</option>
          <option value="Cocinas">Cocinas</option>
          <option value="Pequeños">Pequeños</option>
        </select>
        <select id="sortBy">
          <option value="relevancia">Ordenar por: Relevancia</option>
          <option value="precio-asc">Precio: menor a mayor</option>
          <option value="precio-desc">Precio: mayor a menor</option>
          <option value="nombre-asc">Nombre A→Z</option>
        </select>
      </div>
      <div class="muted">Ingresá tu cupón al finalizar la compra</div>
    </div>
  </section>

  <main class="container">
    <h1>Ofertas destacadas</h1>
    <div id="productsGrid" class="grid"></div>
  </main>

  <!-- Carrito -->
  <aside id="cartDrawer" class="cart">
    <div class="cart__header">
      <h3>Tu carrito</h3>
      <button id="closeCart" aria-label="Cerrar">✕</button>
    </div>
    <div id="cartItems" class="cart__items"></div>
    <div class="cart__footer">
      <div class="cart__row"><span>Subtotal</span><strong id="cartSubtotal">$ 0</strong></div>
      <div id="discountLines"></div>
      <div class="cart__total"><span>Total</span><strong id="cartTotal">$ 0</strong></div>

      <input id="couponInput" type="text" placeholder="Ingresar cupón" style="padding:8px;border-radius:8px;border:1px solid var(--border);margin-top:8px">
      <button id="applyCoupon" class="btn btn--ghost">Aplicar cupón</button>
      <div id="couponMsg" class="muted"></div>

      <button id="checkoutBtn" class="btn btn--primary">Finalizar compra por WhatsApp</button>
      <button id="clearCart" class="btn btn--ghost">Vaciar carrito</button>
    </div>
  </aside>
  <div id="backdrop" class="backdrop"></div>

  <footer class="container" style="padding:24px 0;color:var(--muted)">
    <p>© <span id="year"></span> Nahuel Electrohogar</p>
  </footer>

<script>
/* ================== Utilidades ================== */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const money = n => n.toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});

/* ================== Catálogo (precio base contado) ==================
   Mostramos únicamente 4 cuotas:
   cuota = Math.round(contado * 0.5)
   total = cuota * 4  (equivale a contado * 2)
*/
const PRODUCTS = [
  { id: 4,  name: "Aire Acond. Split 3000W", category: "Aires",     cash: 500000,  img: "./img/aire-split-3000w.jpg" }, // 4×$250.000 por defecto
  { id: 1,  name: "Heladera Samsung 360L",   category: "Heladeras", cash: 699999,  img: "./img/heladera-samsung-360l.jpg" },
  { id: 2,  name: "Lavarropas LG 8kg",       category: "Lavarropas",cash: 589999,  img: "./img/lavarropas-lg-8kg.jpg" },
  { id: 3,  name: "Microondas BGH 28L",      category: "Microondas",cash: 149999,  img: "./img/microondas-bgh-28l.jpg" },
  { id: 5,  name: "Smart TV LG 55\"",        category: "TV",        cash: 679999,  img: "./img/tv-lg-55-4k.jpg" },
  { id: 6,  name: "Pava Eléctrica Inox",     category: "Pequeños",  cash: 45999,   img: "./img/pava-inox-17.jpg" },
  { id: 7,  name: "Cocina Orbis 56cm",       category: "Cocinas",   cash: 459999,  img: "./img/cocina-orbis-56cm.jpg" },
  { id: 9,  name: "TV Xiaomi 86\"",          category: "TV",        cash: 899999,  img: "./img/tv-xiaomi-86.jpg" },
];

/* ================== Cupones ==================
  Tipos soportados:
  - {type:'percent', value:10}  => desc % sobre total
  - {type:'fixed', value:50000} => desc fijo sobre total
  - {type:'installment_override', targetId: 4, value:240000} => fija la cuota de un producto
  Todos son de un solo uso por cliente (localStorage).
*/
const COUPONS = {
  "AIRESPLIT10": { type: "installment_override", targetId: 4, value: 240000, note:"Aire 4x$240.000" },

  "VERO5":   { type:"percent", value:5,  note:"5% OFF en el total" },
  "VERO10":  { type:"percent", value:10, note:"10% OFF en el total" },
  "PROMO7":  { type:"percent", value:7,  note:"7% OFF en el total" },

  "MEGA15K": { type:"fixed", value:15000, note:"$15.000 OFF" },
  "MEGA30K": { type:"fixed", value:30000, note:"$30.000 OFF" },
  "SAVE50K": { type:"fixed", value:50000, note:"$50.000 OFF" },

  "EXTRA3":  { type:"percent", value:3,  note:"3% OFF" },
  "EXTRA8":  { type:"percent", value:8,  note:"8% OFF" },
  "EXTRA12": { type:"percent", value:12, note:"12% OFF" }
};

// Guardamos cupones usados en localStorage
const USED_KEY = "usedCoupons_v1";
function getUsed(){ return JSON.parse(localStorage.getItem(USED_KEY) || "[]"); }
function markUsed(code){ const s=new Set(getUsed()); s.add(code); localStorage.setItem(USED_KEY, JSON.stringify([...s])); }
function isUsed(code){ return getUsed().includes(code); }

/* ================== Estado ================== */
let state = {
  q: "", category: "all", sort: "relevancia",
  cart: JSON.parse(localStorage.getItem("cart") || "[]"), // [{id, qty}]
  appliedCoupons: [] // [{code, info}]
};
const cartCount   = $("#cartCount");
const cartItems   = $("#cartItems");
const cartSubtotal= $("#cartSubtotal");
const cartTotal   = $("#cartTotal");
const discountBox = $("#discountLines");

/* ================== Helpers precios ================== */
function findProd(id){ return PRODUCTS.find(p=>p.id===id); }
function baseInstallment(p){ return Math.round(p.cash * 0.5); } // 4 cuotas: contado*0.5
function itemInstallment(p){
  // aplicar override si hay cupón de tipo installment_override para este id
  const override = state.appliedCoupons.find(c=>c.info.type==="installment_override" && c.info.targetId===p.id);
  if(override) return override.info.value;
  return baseInstallment(p);
}

/* ================== Render productos ================== */
const grid = $("#productsGrid");
function productCard(p){
  const cuota = itemInstallment(p);
  return `
    <article class="card">
      <img src="${p.img}" alt="${p.name}" class="card-img" loading="lazy">
      <div class="card-body">
        <h3 class="card-title">${p.name}</h3>
        <div class="price">4 cuotas de ${money(cuota)}</div>
        <button class="btn btn--primary" data-add="${p.id}">Agregar</button>
      </div>
    </article>
  `;
}
function applyFilters(list){
  let res = [...list];
  if (state.q.trim()){
    const q = state.q.toLowerCase();
    res = res.filter(p => (p.name + " " + p.category).toLowerCase().includes(q));
  }
  if (state.category !== "all") res = res.filter(p => p.category === state.category);
  switch(state.sort){
    case "precio-asc": res.sort((a,b)=>itemInstallment(a)-itemInstallment(b)); break;
    case "precio-desc": res.sort((a,b)=>itemInstallment(b)-itemInstallment(a)); break;
    case "nombre-asc": res.sort((a,b)=>a.name.localeCompare(b.name)); break;
  }
  return res;
}
function render(){
  const list = applyFilters(PRODUCTS);
  grid.innerHTML = list.map(productCard).join("") || `<p class="muted">No se encontraron productos.</p>`;
  $$("[data-add]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = Number(btn.getAttribute("data-add"));
      addToCart(id);
    });
  });
}

/* ================== Carrito ================== */
function persist(){ localStorage.setItem("cart", JSON.stringify(state.cart)); cartCount.textContent = state.cart.reduce((a,b)=>a+b.qty,0); }
function addToCart(id){ const f=state.cart.find(i=>i.id===id); if(f) f.qty++; else state.cart.push({id, qty:1}); persist(); drawCart(); openCart(); }
function removeFromCart(id){ state.cart = state.cart.filter(i=>i.id!==id); persist(); drawCart(); }
function changeQty(id,delta){ const it=state.cart.find(i=>i.id===id); if(!it) return; it.qty=Math.max(1,it.qty+delta); persist(); drawCart(); }

function computeTotals(){
  // Subtotal base (en “total compra” = 4 cuotas)
  let subtotal = 0;
  state.cart.forEach(it=>{
    const p = findProd(it.id);
    if(!p) return;
    const cuota = itemInstallment(p);
    subtotal += (cuota * 4) * it.qty;
  });

  let discountLines = [];
  let total = subtotal;

  // Aplicar cupones percent/fixed sobre total (los override ya impactaron en itemInstallment)
  state.appliedCoupons.forEach(c=>{
    const info = c.info;
    if(info.type==="percent"){
      const d = Math.round(total * (info.value/100));
      total -= d;
      discountLines.push({label:`Cupón ${c.code} (${info.value}% OFF)`, value:`- ${money(d)}`});
    } else if(info.type==="fixed"){
      const d = Math.min(info.value, total);
      total -= d;
      discountLines.push({label:`Cupón ${c.code} (${info.note||"Descuento"})`, value:`- ${money(d)}`});
    } else if(info.type==="installment_override"){
      // Ya aplicado en el precio por cuota; solo mostramos leyenda
      discountLines.push({label:`Cupón ${c.code} (${info.note})`, value:`incl.`});
    }
  });

  return { subtotal, discountLines, total };
}

function drawCart(){
  // Items
  if(!state.cart.length){
    cartItems.innerHTML = `<p class="muted">Tu carrito está vacío.</p>`;
  } else {
    cartItems.innerHTML = state.cart.map(it=>{
      const p = findProd(it.id);
      if(!p) return "";
      const cuota = itemInstallment(p);
      return `
        <div class="cartline">
          <div class="cartline__info">
            <strong>${p.name}</strong>
            <span>4 cuotas de ${money(cuota)}</span>
          </div>
          <div class="cartline__qty">
            <button type="button" data-dec="${it.id}">−</button>
            <span>${it.qty}</span>
            <button type="button" data-inc="${it.id}">+</button>
            <button type="button" class="link danger" data-del="${it.id}">Quitar</button>
          </div>
        </div>
      `;
    }).join("");
  }

  // Totales
  const {subtotal, discountLines, total} = computeTotals();
  cartSubtotal.textContent = money(subtotal);
  cartTotal.textContent    = money(total);

  // Líneas de descuentos
  if(discountLines.length){
    discountBox.innerHTML = discountLines.map(l=>`<div class="discount-line"><span>${l.label}</span><span>${l.value}</span></div>`).join("");
  }else{
    discountBox.innerHTML = "";
  }

  // Delegación qty/remove
  cartItems.onclick = (e) => {
    const t = e.target;
    if (t.matches("[data-inc]")) return changeQty(Number(t.dataset.inc), +1);
    if (t.matches("[data-dec]")) return changeQty(Number(t.dataset.dec), -1);
    if (t.matches("[data-del]")) return removeFromCart(Number(t.dataset.del));
  };
}

/* ================== Cupón ================== */
function applyCoupon(){
  const raw = $("#couponInput").value.trim();
  if(!raw) return;
  const code = raw.toUpperCase();

  if(!COUPONS[code]){ $("#couponMsg").textContent = "Cupón inválido."; $("#couponMsg").className="coupon-bad"; return; }
  if(isUsed(code)){   $("#couponMsg").textContent = "Este cupón ya fue usado."; $("#couponMsg").className="coupon-bad"; return; }
  if(state.appliedCoupons.find(c=>c.code===code)){ $("#couponMsg").textContent="El cupón ya está aplicado."; $("#couponMsg").className="coupon-bad"; return; }

  // Validación mínima: si es override de cuota, chequear que el producto esté en carrito
  const info = COUPONS[code];
  if(info.type==="installment_override"){
    const has = state.cart.some(it=>it.id===info.targetId);
    if(!has){ $("#couponMsg").textContent="Agregá el producto al carrito antes de aplicar este cupón."; $("#couponMsg").className="coupon-bad"; return; }
  }

  state.appliedCoupons.push({code, info});
  markUsed(code); // un solo uso por cliente (navegador)
  $("#couponMsg").textContent = `Cupón aplicado: ${info.note || code}`;
  $("#couponMsg").className = "coupon-ok";
  drawCart();
}

/* ================== Drawer & acciones ================== */
function openCart(){ $("#cartDrawer").classList.add("open"); $("#backdrop").classList.add("show"); }
function closeCart(){ $("#cartDrawer").classList.remove("open"); $("#backdrop").classList.remove("show"); }
$("#openCart").addEventListener("click", openCart);
$("#closeCart").addEventListener("click", closeCart);
$("#backdrop").addEventListener("click", closeCart);
$("#clearCart").addEventListener("click", ()=>{ state.cart=[]; persist(); drawCart(); });
$("#applyCoupon").addEventListener("click", applyCoupon);

// Buscar / filtrar / ordenar
$("#searchBtn").addEventListener("click", ()=>{ state.q = $("#searchInput").value || ""; render(); });
$("#searchInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ state.q = e.target.value; render(); }});
$("#categoryFilter").addEventListener("change", (e)=>{ state.category = e.target.value; render(); });
$("#sortBy").addEventListener("change", (e)=>{ state.sort = e.target.value; render(); });

// WhatsApp
const WHATSAPP_NUMBER = "5491127631167";
$("#checkoutBtn").addEventListener("click", ()=>{
  if(!state.cart.length) return alert("Carrito vacío");
  const lines = state.cart.map(it=>{
    const p = findProd(it.id); if(!p) return "";
    const cuota = itemInstallment(p);
    return `• ${p.name} x${it.qty} — 4 cuotas de ${money(cuota)}`;
  }).join("%0A");
  const total = cartTotal.textContent;
  const msg = `Hola, quiero comprar:%0A${lines}%0A%0ATotal: ${total}`;
  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`,"_blank");
});

// Init
document.getElementById("year").textContent = new Date().getFullYear();
persist(); render(); drawCart();
</script>
</body>
</html>







